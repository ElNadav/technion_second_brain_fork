---
aliases:
  - שיטת אויילר
  - שיטת רונגה-קוטה
  - שגיאה כללית במד"ר
  - שגיאה מקומית במד"ר
  - פתרון נומרי למערכת מד"ר
  - פתרון נומרי למד"ר
---
# מבוא
אנו כבר מכירים ש[[../DEQ1/DEQ1_001 מבוא#משוואה דיפרנציאלית רגילה|מד"רים]] יכולים להיות קשים לפתרונות אנליטיים, ובעוד [[../PDE1/PDE1_001 הקדמה ומשוואות מסדר ראשון#משוואה דיפרנציאלית חלקית|מדח"ים]] לרוב לא פתירים בכלל, חוץ מכמה משפחות מסוימות. לכן, הביקוש לפתרונות נומריים של משוואות דיפרנציאליות הוא מאוד גבוה.

# שיטת אויילר

**שיטת אויילר**, הידועה גם בשם **שיטת אויילר לפנים**, היא השיטה הפשוטה ביותר לפתרון מד"ר עם תנאי התחלה.
אנו נעסוק בפתרון מד"ר מהצורה:
$$y'=f(t,y)$$
כאשר $f$ נתון, ונרצה למצוא את $y$.

## פיתוח השיטה
נגדיר את הנקודות:
$${t}_{0}=a,\, \quad t_{i}=a+ih,\, \quad i=0,1,2,\dots ,N$$
כאשר $h=\dfrac{b-a}{N}$ הוא גודל הצעד. לפי [[NUM1_010 גזירה נומרית#שיטות בשתי נקודות|שיטת ההפרשים לפנים]], הנגזרת מקיימת:
$$y'(t_{i})= \dfrac{y(t_{i+1})-y(t_{i})}{h}-\dfrac{h}{2}y''(\xi_{i})$$
נציב במד"ר, ונקבל ביטוי ל-$y(t_{i+1})$:
$$y(t_{i+1})=y(t_{i})+hf(t_{i},y(t_{i}))+\dfrac{h^{2}}{2}y''(\xi_{i})$$
 נסמן את הפתרון המשוער של $y(t_{i})$ ב-$y_{i}$, ונקבל את **שיטת אויילר לפנים**, שמשערת את הפתרון $\{ y_{i} \}_{i=0}^{N}$ בצורה הבאה:
$$\boxed {
\begin{aligned}
 & {y}_{0}=c \\
 & y_{i+1}=y_{i}+hf(t_{i},y_{i}),\, \quad i=0,1,\dots ,N-1
\end{aligned}
 }$$
כאשר ${y}_{0}=c$ הוא התנאי התחלה שלנו.

![[NUM1_011/Screenshot_20240322_182502_OneDrive.jpg|book]]
> שני שלבים של שיטת אוילר לפנים. הפיתרון המדויק הוא הגרף הרציף. הערכים הנומריים שהתקבלו בשיטת אוילר מוקפים בעיגול. 



השגיאה (האמיתית) של שיטה זו וכל שיטה לפתרון נומרי של מד"ר נקראת ה**שגיאה הכללית/גלובלית**, והיא נתונה ע"י:
$$e_{i}=y(t_{i})-y_{i}$$
עבור שיטת אויילר, כבר ראינו מהפיתוח כי:
$$e_{i}=\dfrac{h^{2}}{2}(\xi_{i})$$
כאשר $t_{i}\leq \xi_{i}\leq t_{i+1}$. נסיק כי לשיטה זו שגיאה כללית מסדר $2$.

נגדיר עוד שגיאה לשיטות נומריות לפתרון מד"ר: **שגיאה מקומית $d_{i}$.** שגיאה מקומית היא השגיאה שנוצרת בצעד יחיד של השיטה, ביחס לגודל הצעד. כלומר:
$$d_{i}=\dfrac{y(t_{i+1})-y(t_{i})}{h}-\dfrac{y_{i+1}-y_{i}}{h}$$

במקרה של שיטת אויילר:
$$d_{i}=\dfrac{y(t_{i+1})-y(t_{i})}{h}-f(t_{i},y(t_{i}))$$

מהפיתוח שביצענו עבור השיטה, ניתן להראות כי:
$$d_{i}=\dfrac{h}{2}h''(\xi_{i})$$
כאשר $t_{i}\leq \xi_{i}\leq \xi_{t+1}$. נסיק כי לשיטה זו שגיאה מקומית מסדר $1$.


>[!example] דוגמה: 
 >נביט במד"ר הבא:
 >$$y'=y,\, \quad y(0)=1$$
 >הפתרון האמיתי הוא $y(t)=e^{t}$. נפתור בשיטת אויילר:
 >$$\begin{aligned}
 & {y}_{0}=1 \\
 & y_{i+1}=y_{i}+hy_{i}=(1+h)y_{i},\, \quad i=0,1,2\dots 
\end{aligned}$$
>נקבל את הפתרונות הבאים עבור $h=0.2$ ($y(t_{i})$ הוא הפתרון האמיתי, ואילו $y_{i}$ הוא הפתרון המשוער):
>$$\begin{array}{c|c}
t_{i} & y(t_{i}) & y_{i}  & \text{Error}\\
\hline 0 & 1.000 & 1.000 & 0.0 \\
0.2 & 1.221 & 1.200  & 0.021\\
0.4 & 1.492 & 1.440 & 0.052 \\
0.6 & 1.822 & 1.728 & 0.094
\end{array}$$
>עבור $h=0.1$:
>$$\begin{array}{c|c}
t_{i} & y(t_{i}) & y_{i} & \text{Error} \\
\hline 0 & 1.000 & 1.000 & 0.0 \\
0.1 & 1.105 &  1.100 & 0.005 \\
0.2 & 1.221 & 1.210 & 0.011 \\
0.3 & 1.350 & 1.331 & 0.019 \\
0.4 & 1.492 & 1.464 & 0.028 \\
0.5 & 1.694 & 1.611 & 0.038 \\
0.6 & 1.822 & 1.772 & 0.051
\end{array}$$
>נשים לב שהשגיאה שלנו קטנה בערך פי $2$ כאשר $h$ קטן באותה מידה. בנוסף, השגיאה שלנו גדלה ככל ש-$t_{i}$ גדל. 


# שיטות רונגה-קוטה (Runge-Kutta)
שיטת אויילר בעלת שגיאה מסדר ראשון. לכן, היא שיטה לא יעילה כל כך - הצעד $h$ שלוקחים כל פעם צריך להיות מאוד קטן כדי לקבל פתרון שימושי.

כדי להתחיל להסביר שיטות עם סדר שגיאה יותר גבוה, נביט במד"ר $y'=f(t,y)$, בצעד אחד, מ-$t_{i}$ ל-$t_{i+1}$. נניח כי הקירוב $y_{i}$ עבור $y(t_{i})$ ידוע, ונפתח שיטות לקבל את קירוב $y_{i+1}$ ל-$y(t_{i+1})$ בנקודה הבאה $t_{i+1}$.

שיטה מאוד נפוצה היא להשתמש רק במידע בצעד הנוכחי - $[t_{i},t_{i+1}]$. **שיטת רונגה-קוטה** היא שיטה בה מבצעים חישובים חוזרים כדי בצעד אחד כדי לקבל קירוב מסדר יותר גבוה.

![[NUM1_011/Screenshot_20240322_215700_OneDrive.jpg|book|400]]
> שיטת רונגה-קוטה: חישובים חוזרים של הפונקציה $f$ בקטע $[t_{i},t_{i+1}]$ משולבים כדי לקבל קירוב יותר טוב $y_{i+1}$ ב-$t_{i+1}$.

כעת נפתח שאת שיטות הטרפז ושיטות הביניים שהן כולן סוגים שונים של שיטות רונגה-קוטה.
## שיטת אויילר המתוקנת
אם נבצע אינטגרציה על המד"ר שלנו לפי $t$, בקטע $[t_{i},t_{i+1}]$, נקבל:
$$\int_{t}^{t_{i+1}} y'(t) \, \mathrm{d}t=\int_{t_{i}}^{t_{i+1}} f(t,y(t)) \, \mathrm{d}x  $$

לפי [[../CAL1/CAL1_008 אינטגרל מסוים#המשפט היסודי של החדו"א|המשפט היסודי של החדוא]], נקבל:
$$y(t_{i+1})-y(t_{i})=\int_{t_{i}}^{t_{i+1}} f(t,y(t)) \, \mathrm{d}t $$

נעביר אגפים:
$$y(t_{i+1})=y(t_{i})+\int_{t_{i}}^{t_{i+1}} f(t,y(t)) \, \mathrm{d}t $$
כדי לחשב את האינטגרל, ניעזר בקירוב שלו לפי [[NUM1_009 אינטגרציה נומרית#פיתוח שיטות בסיסיות|שיטת הטרפזים]], ונקבל את **שיטת הטרפזים הסתומה**:
$$\boxed {
y_{i+1}=y_{i}+\dfrac{h}{2}[f(t_{i},y_{i})+f(t_{i+1},y_{i+1})]
 }$$
קוראים לשיטה זו סתומה כי החישוב של $y_{i+1}$ תלוי ב-$y_{i+1}$ בעצמו (בביטוי האחרון מצד ימין). לכן, יש הפרדה בין שיטות סתומות לשיטות לא סתומות. נרצה להפוך את שיטה זו ללא סתומה, ובכך לחשב את $y_{i+1}$ יותר בפשטות.
נשתמש ב[[#שיטת אויילר]] כדי לחשב בקירוב את $y_{i+1}$:
$${Y}_{}=y_{i+1}=y_{i}+hf(t_{i},y_{i})$$
כעת נוכל להציב זאת בשיטה הסתומה, כדי לקבל את **שיטת הטרפזים**, שנקראת גם **שיטת אויילר המתוקנת**:
$$\boxed {
y_{i+1}=y_{i}+\dfrac{h}{2}(f(t_{i},y_{i})+f(t_{i+1},{Y}_{}))
 }$$

נשים לב כי שיטה זו כוללת שני חישובים של $f$ בשלב $i$. נאמר כי זוהי שיטת $\mathrm{RK}$ בשני שלבים.

השגיאה המקומית:
$$d_{i}= \dfrac{y(t_{i+1})-y(t_{i})}{h}-\dfrac{1}{2}[f(t_{i},y(t_{i})+f(t_{i+1},\hat{Y}))]$$
כאשר $\hat{Y}=y(t_{i})+hy'(t_{i})$. משגיאת שיטת הטרפזים (עבור אינטגרלים), ניתן להראות אחרי פיתוח מאוד טכני ומשעמם שהשגיאה המקומית תהיה $d_{i}=\mathcal{O}(h^{2})$, כלומר מסדר $2$.

## שיטת אויילר המשופרת
נוכל גם לקבל קירוב עבור האינטגרל בעזרת קירוב ביניים, כדי לקבל את **שיטת הביניים הסתומה**:
$$y_{i+1}=y_{i}+hf(t_{i+1/2},\, y_{i+1/2})$$
כאשר:
$$t_{i+1/2}=\dfrac{t_{i}+t_{i+1}}{2}=t_{i}+\dfrac{h}{2},\, \quad \quad y_{i+1/2}=\dfrac{y_{i}+y_{i+1}}{2}$$
נשתמש בשיטת אויילר כדי למצוא קירוב ל-$y_{i+1/2}$:
$$Y=y_i+\dfrac{h}{2}f(t_{i},y_{i})$$
נציב, ונקבל את **שיטת הביניים**, שנקראת גם **שיטת שיטת אויילר המשופרת**:
$$\boxed {
y_{i+1}=y_{i}+hf(t_{i+1/2},\, Y)
 }$$
 כמו מקודם, זוהי שיטת $\mathrm{RK}$ בשני שלבים, עם שגיאה מסדר $2$.

## שיטת רונגה-קוטה הקלאסית
**שיטת רונגה-קוטה** הקלאסית מבוססת על אינטגרציה לפי [[NUM1_009 אינטגרציה נומרית#פיתוח שיטות בסיסיות|שיטת סימפסון]], ויש בה $4$ שלבים, כדי לקבל דיוק מסדר $\mathcal{O}(h^{4})$. היא נתונה ע"י:
$$\boxed {
\begin{aligned}
 & {Y}_{1}=y_{i} \\[1ex]
 & {Y}_{2}=y_{i}+\dfrac{h}{2}f(t_{i},{Y}_{1}) \\
 & {Y}_{3}=y_{i}+\dfrac{h}{2}f(t_{i+1/2}{Y}_{2}) \\[1ex]
 & {Y}_{4}=y_{i}+hf(t_{i+1/2},{Y}_{3}) \\[2ex]
 & 
y_{i+1}=y_{i}+\dfrac{h}{6}[f(t_{i},{Y}_{1})+2f(t_{i+1/2},{Y}_{2}) \\
 & \quad \quad \quad +2f(t_{i+1/2},{Y}_{3})+f(t_{i+1},{Y}_{4})]
\end{aligned}
 }$$

הפיתוח של השיטה וההוכחה שהשגיאה של היא מסדר $4$ היא מסובכת שאפילו לספר לא היה כוח להראות אותו.

>[!example] דוגמה: 
 >נביט במד"ר הבא:
 >$$y'=-y^{2},\, \quad \quad y(1)=1$$
 >הפתרון האמיתי הוא $y(t)=\dfrac{1}{t}$. נראה את השגיאות ב-$t=10$:
>$$\begin{array}{c|c} 
h & \text{Euler} & \mathrm{RK}2 & \mathrm{RK}4 \\
\hline 0.2 & \pu{4.7e-3} & \pu{3.3e-4} & \pu{2.0e-7} \\
\hline 0.1 & \pu{2.3e-3} & \pu{7.4e-5} & \pu{1.4e-8} \\
\hline 0.05 & \pu{1.2e-3} & \pu{1.8e-5} & \pu{8.6e-10} \\
\hline 0.02 & \pu{4.6e-4} & \pu{2.8e-6} & \pu{2.2e-11} \\
\hline 0.01 & \pu{2.3e-4} & \pu{6.8e-7} & \pu{1.4e-12}
\end{array}$$
>ניתן באמת לראות שכל השיטות נותנות שגיאות מסדר $1,2,4$ בהתאמה.

# מערכת משוואות דיפרנציאליות

>[!TODO] להשלים
>

